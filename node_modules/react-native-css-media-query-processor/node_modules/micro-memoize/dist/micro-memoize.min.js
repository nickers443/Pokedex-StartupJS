!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self)["micro-memoize"]=n()}(this,function(){"use strict";var M={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0};function E(e){var a=e.isEqual,r=e.isMatchingKey,o=e.maxSize;return"function"==typeof r?function(e,n){if(r(e[0],n))return 0;if(1<o)for(var t=e.length,i=1;i<t;i++)if(r(e[i],n))return i;return-1}:1<o?function(e,n){for(var t,i=e.length,r=n.length,o=0;o<i;o++)if((t=e[o]).length===r){for(var u=0;u<r&&a(t[u],n[u]);u++);if(u===r)return o}return-1}:function(e,n){var t=e[0],i=t.length;if(n.length!==i)return-1;for(var r=0;r<i;r++)if(!a(t[r],n[r]))return-1;return 0}}function S(e){return"function"==typeof e}function q(e,n){return e===n||e!=e&&n!=n}function A(e,n,t,i,r){for(var o=i;o--;)e.keys[o+1]=e.keys[o],e.values[o+1]=e.values[o];e.keys[0]=n,e.values[0]=t,r<=i&&(e.keys.length=r,e.values.length=r)}var H=Function.prototype.bind.call(Function.prototype.call,Array.prototype.slice);return function(o,e){if(void 0===e&&(e={}),function(e){return S(e)&&e.isMemoized}(o))return o;if(!S(o))throw new TypeError("You must pass a function to `memoize`.");function u(){var e=z?H(arguments,0):arguments,n=k?v(e):e,t=d.length?p(d,n):-1;if(-1!==t)x&&h(C,y,u),t&&(A(C,d[t],m[t],t,c),K&&l(C,y,u));else{var i=o.apply(this,arguments),r=z?n:H(arguments,0);A(C,r,i,d.length,c),a&&g(C,u),b&&s(C,y,u),K&&l(C,y,u)}return m[0]}var n=e.isEqual,t=void 0===n?q:n,i=e.isMatchingKey,r=e.isPromise,a=void 0!==r&&r,f=e.maxSize,c=void 0===f?1:f,s=e.onCacheAdd,l=e.onCacheChange,h=e.onCacheHit,v=e.transformKey,y=function(e,n){var t={};for(var i in e)t[i]=e[i];for(var i in n)t[i]=n[i];return t}(function(e){var n={};for(var t in e)M[t]||(n[t]=e[t]);return n}(e),{isEqual:t,isMatchingKey:i,isPromise:a,maxSize:c,onCacheAdd:s,onCacheChange:l,onCacheHit:h,transformKey:v}),p=E(y),g=function(r){var o=E(r),u=r.onCacheChange,a=r.onCacheHit,f="function"==typeof u,c="function"==typeof a;return function(t,n){var i=t.keys[0];t.values[0]=t.values[0].then(function(e){return c&&a(t,r,n),f&&u(t,r,n),e}).catch(function(e){var n=o(t.keys,i);throw-1!==n&&(t.keys.splice(n,1),t.values.splice(n,1)),e})}}(y),d=[],m=[],C={keys:d,get size(){return C.keys.length},values:m},k="function"==typeof v,z=!(!v&&!i),b="function"==typeof s,K="function"==typeof l,x="function"==typeof h;return Object.defineProperties(u,{cache:{configurable:!0,value:C},cacheSnapshot:{configurable:!0,get:function(){return{keys:H(C.keys,0),size:C.size,values:H(C.values,0)}}},isMemoized:{configurable:!0,value:!0},options:{configurable:!0,value:y}}),u}});
